name: Google Chat Notify
on:
  issues:
    types: [opened, edited] # ä½œæˆã¨ç·¨é›†ã®ä¸¡æ–¹ã«åå¿œ

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Auth Google Cloud
        uses: google-github-actions/auth@v2
        with:
          credentials_json: ${{ secrets.GOOGLE_CHAT_CREDENTIALS }}

      - name: Send Message
        run: |
          # ã‚¹ãƒšãƒ¼ã‚¹IDã¯ã”è‡ªèº«ã®ã‚‚ã®ã«æ›¸ãæ›ãˆã¦ãã ã•ã„
          SPACE_ID="spaces/AAQASOkPwoA"
          
          # GitHub ActionsãŒè‡ªå‹•ã§æŒã£ã¦ã„ã‚‹å¤‰æ•°ã‚’åˆ©ç”¨
          ISSUE_TITLE="${{ github.event.issue.title }}"
          ISSUE_URL="${{ github.event.issue.html_url }}"
          ACTION="${{ github.event.action }}" # opened ã‹ edited ãŒå…¥ã‚‹

          curl -X POST \
            -H "Authorization: Bearer $(gcloud auth print-access-token)" \
            -H "Content-Type: application/json" \
            "https://chat.googleapis.com/v1/$SPACE_ID/messages" \
            -d "{
              \"text\": \"ğŸ“¢ **Issue ${{ github.event.action }}**\nã‚¿ã‚¤ãƒˆãƒ«: $ISSUE_TITLE\nURL: $ISSUE_URL\"
            }"
