name: Google Chat Notification

on:
  issues:
    types: [opened, edited, reopened]
  push:
    branches: [ "main" ]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Notification via curl
        env:
          # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãŸã‚URLã¯Secretsã«ç™»éŒ²ã™ã‚‹ã“ã¨ã‚’å¼·ãæ¨å¥¨ã—ã¾ã™
          # ç™»éŒ²å: GOOGLE_CHAT_WEBHOOK
          WEBHOOK_URL: ${{ secrets.GOOGLE_CHAT_WEBHOOK }}
        run: |
          # é€šçŸ¥å†…å®¹ã®æ§‹ç¯‰
          # ãƒ’ã‚¢ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ(EOF)ã‚’ä½¿ã†ã“ã¨ã§ã€æ”¹è¡Œã‚„å¤‰æ•°ã‚’å®‰å…¨ã«JSONã¸å¤‰æ›ã§ãã¾ã™
          JSON_DATA=$(cat <<EOF
          {
            "text": "ğŸ“‹ *GitHubãƒªãƒã‚¸ãƒˆãƒªæ›´æ–°é€šçŸ¥*\n\n**ã‚¤ãƒ™ãƒ³ãƒˆ:** ${{ github.event_name }}\n**å®Ÿè¡Œè€…:** ${{ github.actor }}\n**URL:** ${{ github.event.issue.html_url || github.event.compare }}"
          }
          EOF
          )

          # Google Chatã¸POSTé€ä¿¡
          curl -X POST -H 'Content-Type: application/json' \
          -d "$JSON_DATA" \
          "$WEBHOOK_URL"
