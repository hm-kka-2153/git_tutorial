name: Issue Notification
on:
  issues:
    types: [opened, edited]
  issue_comment:
    types: [created]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Google Chat Notification
        run: |
          # ã‚³ãƒ¡ãƒ³ãƒˆãŒã‚ã‚‹å ´åˆã¯ã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡ã€ãªã„å ´åˆã¯Issueæœ¬æ–‡ã‚’é¸æŠ
          CONTENT="${{ github.event.comment.body || github.event.issue.body }}"
          
          # JSONã®ã‚¨ãƒ©ãƒ¼ã‚’é˜²ããŸã‚ã€æ”¹è¡Œã‚³ãƒ¼ãƒ‰ãªã©ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†
          # (ã“ã®1è¡Œã‚’å…¥ã‚Œã‚‹ã“ã¨ã§ã€è¤‡é›‘ãªæœ¬æ–‡ã§ã‚‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã«ãããªã‚Šã¾ã™)
          SAFE_CONTENT=$(echo "$CONTENT" | python3 -c 'import json,sys; print(json.dumps(sys.stdin.read()))')

          curl -X POST "${{ secrets.GOOGLE_CHAT_WEBHOOK }}" \
          -H "Content-Type: application/json; charset=UTF-8" \
          -d "{
            \"text\": \"ğŸ“‹ *Issueæ›´æ–°: ${{ github.event.issue.title }}*\n\nğŸ‘¤ *å®Ÿè¡Œè€…*: ${{ github.actor }} (${{ github.event.action }})\n\nğŸ“ *å†…å®¹*:\n${SAFE_CONTENT:1:-1}\n\nğŸ”— *URL*: ${{ github.event.comment.html_url || github.event.issue.html_url }}\"
          }"
